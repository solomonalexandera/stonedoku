Plan research for splitting managers into separate files Read app.js, lines 1 to 4000 Read index.html, lines 1 to 400 Searched for text app.js (**/service-worker.js**/*), no results Read firebase.json Create operation todo list Fetch prior research results Searched for regex subagent|research JSON|research.json|subagent_results|subagent-results|research_results|research.json, no results Searched for regex "research"|"subagent"|"research.json"|"subagent_results" (**/*.{json,md,txt,log,js,ts}), no results Planned steps (brief) Scaffold src/client/{managers,lib} and barrels. Extract core libs and add unit tests. Incrementally extract managers (Profile → Friends → Lobby → Match). Add src/client/entry.js that initializes Firebase and exposes a compatibility surface. Add bundler (Rollup/Vite), npm scripts, and CI updates. Update HTML runners and run tests; iterate until green. Plan: Split managers into modules and convert to full-stack layout TL;DR Move from one large app.js to a modular ES-module layout so each manager lives in its own file, tests are colocated, and a small build step produces a single hostable bundle while preserving a dev ESM workflow. This reduces merge conflicts, enables focused unit tests, and avoids global-symbol regressions by providing a minimal compatibility surface. Steps Scaffold repo layout: create src/client/managers/, src/client/lib/, src/client/ui/, and tests/unit/; add barrel files and a short README describing conventions and export rules. (See app.js for existing manager definitions.) Extract pure libraries first: move SudokuGenerator, ProfanityFilter, logManager and other stateless helpers into src/client/lib/ and add unit tests under tests/unit/. Ensure these modules are side-effect-free. Add src/client/appState.js exporting a single AppState object and accessor helpers; update other modules to import AppState instead of relying on runtime globals. Incrementally extract UI helpers and small managers: move UI, AudioManager, CreativeFeatures, GameHelpers, and GameUI to src/client/ui/ and add unit or integration tests as appropriate. Extract domain managers in dependency order: ProfileManager → FriendsManager → PresenceManager → LobbyManager → MatchManager → ChatManager → ChallengeSystem. For each: Create module file in src/client/managers/. Add focused unit tests and a Playwright integration test where external RTDB/Firestore interactions are required. Update call-sites in app.js to import from new modules. Provide a small compatibility entry src/client/entry.js that: Initializes Firebase (same config path as now), Imports and wires managers in the correct order, Exposes a minimal global surface (e.g. window.App, window.e2e or re-exports) so existing E2E tests and HTML runners (e2e-runner.html, index.html) keep working during migration. Add a bundler and scripts: Add Rollup or Vite config to build a single ES module build/app.bundle.js and produce source maps. Add npm scripts: dev (ESM dev server), build, test, lint. Keep a dev mode that imports modules directly (fast edits) and a production build that bundles for hosting. Update HTML runners and CI: Point e2e-runner.html, index.html, and CI workflow to the new entry or bundle depending on environment. Update service worker / hosting config if necessary (see firebase.json, service-worker.js). Run tests and iterate: Run unit tests first, then Playwright E2E tests. Fix initialization order, circular deps, and timing issues. Keep compatibility shims (small) until all tests and consumers are migrated; then remove old app.js. Cleanup and docs: Remove the monolithic app.js (or keep as compatibility wrapper), update MANAGERS.md with file locations, and add CONTRIBUTING guidance for adding managers and tests. Further Considerations Tests: Require an automated test for each new manager (unit or small integration) and include it in the same commit — follow the playwright harness when RTDB/Firestore is involved. Dependency ordering: Design modules to depend on minimal interfaces (inversion of control) to avoid circular imports; prefer passing AppState or small helper objects rather than importing large modules in both directions. Backwards compatibility: Maintain src/client/entry.js that attaches a minimal global API used by current tests; once all callers point to the new API, remove shims and update the docs (MANAGERS.md and AI_DEFAULT_CONTEXT.md).

Progress (2025-12-31):
- entry.js now publishes the Stonedoku namespace and is loaded before app.js (index + test runners).
- SudokuGenerator ported to src/client/lib with legacy logic; ProfanityFilter/logManager remain extracted.
- Barrel exports and lib README added; unit tests added under tests/unit (node --test) with npm scripts wired.
- AudioManager extracted to src/client/managers/audioManager.js and imported by app.js; managers barrel updated.
- BoardIntegritySystem extracted to src/client/ui/boardIntegrity.js and imported by app.js.
- UI barrel now exports board integrity, GameHelpers, and GameUI factories; GameHelpers instantiated via src/client/ui/gameHelpers.js and GameUI via src/client/ui/gameUi.js with window compatibility shims.
- Remaining: extract the general UI helper object and domain managers into src/client/ui and src/client/managers, introduce bundler (Rollup/Vite), and update CI/HTML runners to use bundled entry once modules are split.