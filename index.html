<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Stonedoku</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg?v=20251223A">
    <link rel="apple-touch-icon" href="/favicon.svg?v=20251223A">
    <meta name="theme-color" content="#111317">
    <meta name="description" content="Compete in real-time 1v1 Sudoku battles with players around the world">
    <!-- Security & Privacy -->
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <!-- Accessibility -->
    <meta name="color-scheme" content="dark light">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css?v=20251222A">
</head>
<body class="light-theme">
    <svg class="ui-sprite" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <symbol id="i-sun" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="4"></circle>
            <path d="M12 2v2M12 20v2M4 12H2M22 12h-2M4.9 4.9l1.4 1.4M17.7 17.7l1.4 1.4M19.1 4.9l-1.4 1.4M6.3 17.7l-1.4 1.4"></path>
        </symbol>
        <symbol id="i-moon" viewBox="0 0 24 24">
            <path d="M21 12.6A8.5 8.5 0 1 1 11.4 3a6.5 6.5 0 0 0 9.6 9.6Z"></path>
        </symbol>
        <symbol id="i-volume" viewBox="0 0 24 24">
            <path d="M11 5 6.5 9H3v6h3.5L11 19V5Z"></path>
            <path d="M15.5 8.5a4.5 4.5 0 0 1 0 7"></path>
            <path d="M18 6a8 8 0 0 1 0 12"></path>
        </symbol>
        <symbol id="i-volume-off" viewBox="0 0 24 24">
            <path d="M11 5 6.5 9H3v6h3.5L11 19V5Z"></path>
            <path d="M16 9l5 6"></path>
            <path d="M21 9l-5 6"></path>
        </symbol>
        <symbol id="i-mail" viewBox="0 0 24 24">
            <path d="M4 6h16v12H4z"></path>
            <path d="m4 7 8 6 8-6"></path>
        </symbol>
        <symbol id="i-lock" viewBox="0 0 24 24">
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            <path d="M6 11h12v10H6z"></path>
        </symbol>
        <symbol id="i-smile" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="9"></circle>
            <circle cx="9" cy="10" r="1" fill="currentColor" stroke="none"></circle>
            <circle cx="15" cy="10" r="1" fill="currentColor" stroke="none"></circle>
            <path d="M8 15c1.2 1 2.6 1.5 4 1.5s2.8-.5 4-1.5"></path>
        </symbol>
        <symbol id="i-book" viewBox="0 0 24 24">
            <path d="M2 4h7a4 4 0 0 1 4 4v14a4 4 0 0 0-4-4H2z"></path>
            <path d="M22 4h-7a4 4 0 0 0-4 4v14a4 4 0 0 1 4-4h7z"></path>
        </symbol>
        <symbol id="i-award" viewBox="0 0 24 24">
            <circle cx="12" cy="8" r="6"></circle>
            <path d="M15.5 12.9 17 22l-5-3-5 3 1.5-9.1"></path>
        </symbol>
        <symbol id="i-crown" viewBox="0 0 24 24">
            <path d="M3 7l4 4 5-7 5 7 4-4v13H3V7z"></path>
        </symbol>
        <symbol id="i-user" viewBox="0 0 24 24">
            <path d="M20 21a8 8 0 0 0-16 0"></path>
            <circle cx="12" cy="8" r="4"></circle>
        </symbol>
        <symbol id="i-refresh" viewBox="0 0 24 24">
            <path d="M20 12a8 8 0 0 1-14.3 4.8"></path>
            <path d="M4 12a8 8 0 0 1 14.3-4.8"></path>
            <path d="M18 3v6h-6"></path>
            <path d="M6 21v-6h6"></path>
        </symbol>
        <symbol id="i-gear" viewBox="0 0 24 24">
            <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"></path>
            <path d="M19.4 15a7.9 7.9 0 0 0 .1-2l2-1.2-2-3.4-2.3.7a7.7 7.7 0 0 0-1.7-1L15 5h-6l-.5 2.1a7.7 7.7 0 0 0-1.7 1L4.5 7.4l-2 3.4 2 1.2a7.9 7.9 0 0 0 .1 2l-2 1.2 2 3.4 2.3-.7c.5.4 1.1.7 1.7 1L9 21h6l.5-2.1c.6-.3 1.2-.6 1.7-1l2.3.7 2-3.4-2-1.2Z"></path>
        </symbol>
        <symbol id="i-undo" viewBox="0 0 24 24">
            <path d="M9 14 4 9l5-5"></path>
            <path d="M4 9h10a6 6 0 0 1 0 12h-2"></path>
        </symbol>
        <symbol id="i-bulb" viewBox="0 0 24 24">
            <path d="M9 18h6"></path>
            <path d="M10 22h4"></path>
            <path d="M8.5 14.5a6 6 0 1 1 7 0c-.7.6-1.1 1.3-1.2 2H9.7c-.1-.7-.5-1.4-1.2-2Z"></path>
        </symbol>
        <symbol id="i-backspace" viewBox="0 0 24 24">
            <path d="M20 6H10L4 12l6 6h10a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2Z"></path>
            <path d="M14.5 9.5 18 13"></path>
            <path d="M18 9.5 14.5 13"></path>
        </symbol>
        <symbol id="i-pencil" viewBox="0 0 24 24">
            <path d="M12 20h9"></path>
            <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5Z"></path>
        </symbol>
        <symbol id="i-camera" viewBox="0 0 24 24">
            <path d="M5 7h4l1.5-2h3L15 7h4a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2Z"></path>
            <circle cx="12" cy="14" r="3"></circle>
        </symbol>
        <symbol id="i-chat" viewBox="0 0 24 24">
            <path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v8Z"></path>
        </symbol>
        <symbol id="i-bolt" viewBox="0 0 24 24">
            <path d="M13 2 3 14h7l-1 8 10-12h-7l1-8Z"></path>
        </symbol>
        <symbol id="i-target" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="8"></circle>
            <circle cx="12" cy="12" r="4"></circle>
            <path d="M12 2v2M22 12h-2"></path>
        </symbol>
        <symbol id="i-chart" viewBox="0 0 24 24">
            <path d="M4 19V5"></path>
            <path d="M4 19h16"></path>
            <path d="M8 16v-6"></path>
            <path d="M12 16v-9"></path>
            <path d="M16 16v-3"></path>
        </symbol>
        <symbol id="i-trophy" viewBox="0 0 24 24">
            <path d="M8 21h8"></path>
            <path d="M12 17v4"></path>
            <path d="M7 4h10v3a5 5 0 0 1-10 0V4Z"></path>
            <path d="M7 6H4a3 3 0 0 0 3 5"></path>
            <path d="M17 6h3a3 3 0 0 1-3 5"></path>
        </symbol>
        <symbol id="i-check" viewBox="0 0 24 24">
            <path d="M20 6 9 17l-5-5"></path>
        </symbol>
        <symbol id="i-x" viewBox="0 0 24 24">
            <path d="M18 6 6 18"></path>
            <path d="M6 6l12 12"></path>
        </symbol>
        <symbol id="i-plus" viewBox="0 0 24 24">
            <path d="M12 5v14"></path>
            <path d="M5 12h14"></path>
        </symbol>
	        <symbol id="i-minus" viewBox="0 0 24 24">
	            <path d="M5 12h14"></path>
	        </symbol>
	        <symbol id="i-menu" viewBox="0 0 24 24">
	            <path d="M4 6h16"></path>
	            <path d="M4 12h16"></path>
	            <path d="M4 18h16"></path>
	        </symbol>
	        <symbol id="i-maximize" viewBox="0 0 24 24">
	            <path d="M4 4h16v16H4z"></path>
	        </symbol>
	        <symbol id="i-chevron-down" viewBox="0 0 24 24">
	            <path d="M6 9l6 6 6-6"></path>
	        </symbol>
	        <symbol id="i-send" viewBox="0 0 24 24">
	            <path d="M22 2 11 13"></path>
	            <path d="M22 2 15 22l-4-9-9-4 20-7Z"></path>
	        </symbol>
        <symbol id="i-copy" viewBox="0 0 24 24">
            <path d="M9 9h10v10H9z"></path>
            <path d="M5 15H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1"></path>
        </symbol>
        <symbol id="i-hourglass" viewBox="0 0 24 24">
            <path d="M6 2h12"></path>
            <path d="M6 22h12"></path>
            <path d="M7 2c0 6 5 6 5 10s-5 4-5 10"></path>
            <path d="M17 2c0 6-5 6-5 10s5 4 5 10"></path>
        </symbol>
        <symbol id="i-grid" viewBox="0 0 24 24">
            <path d="M3 3h18v18H3z"></path>
            <path d="M9 3v18"></path>
            <path d="M15 3v18"></path>
            <path d="M3 9h18"></path>
            <path d="M3 15h18"></path>
        </symbol>
        <symbol id="i-controller" viewBox="0 0 24 24">
            <path d="M7.5 14.5h-2a4.5 4.5 0 0 1 0-9h13a4.5 4.5 0 0 1 0 9h-2"></path>
            <path d="M8 12h4"></path>
            <path d="M10 10v4"></path>
            <path d="M16.5 10.5h.01"></path>
            <path d="M18.5 12.5h.01"></path>
        </symbol>
        <symbol id="i-swords" viewBox="0 0 24 24">
            <path d="M4 20l8-8"></path>
            <path d="M6 4l6 6"></path>
            <path d="M20 20l-8-8"></path>
            <path d="M18 4l-6 6"></path>
            <path d="M8 8 6 10"></path>
            <path d="M16 8l2 2"></path>
        </symbol>
        <symbol id="i-dice" viewBox="0 0 24 24">
            <path d="M5 5h14v14H5z"></path>
            <circle cx="9" cy="9" r="1" fill="currentColor" stroke="none"></circle>
            <circle cx="15" cy="9" r="1" fill="currentColor" stroke="none"></circle>
            <circle cx="12" cy="12" r="1" fill="currentColor" stroke="none"></circle>
            <circle cx="9" cy="15" r="1" fill="currentColor" stroke="none"></circle>
            <circle cx="15" cy="15" r="1" fill="currentColor" stroke="none"></circle>
        </symbol>
        <symbol id="i-users" viewBox="0 0 24 24">
            <path d="M16 11a4 4 0 1 0-8 0"></path>
            <path d="M3 21a9 9 0 0 1 18 0"></path>
            <path d="M20 18a4.5 4.5 0 0 0-3.3-4.3"></path>
            <path d="M7.3 13.7A4.5 4.5 0 0 0 4 18"></path>
        </symbol>
        <symbol id="i-globe" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="9"></circle>
            <path d="M3 12h18"></path>
            <path d="M12 3a12 12 0 0 1 0 18"></path>
            <path d="M12 3a12 12 0 0 0 0 18"></path>
        </symbol>
        <symbol id="i-cookie" viewBox="0 0 24 24">
            <path d="M21 13a8.5 8.5 0 1 1-10-10 4 4 0 0 0 4 4 4 4 0 0 0 4 4 2 2 0 0 0 2-2Z"></path>
            <circle cx="8.5" cy="12" r="1" fill="currentColor" stroke="none"></circle>
            <circle cx="12" cy="15.5" r="1" fill="currentColor" stroke="none"></circle>
            <circle cx="13.5" cy="9.5" r="1" fill="currentColor" stroke="none"></circle>
        </symbol>
    </svg>
    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <a href="#sudoku-board" class="skip-link">Skip to game board</a>
    
    <div class="scene">
        <div class="scene__bg"></div>
        <div class="scene__arches"></div>
        <div class="scene__vignette"></div>
        <div class="scene__dust"></div>
        <div class="scene__content">
    <div id="app" role="application" aria-label="Stonedoku Game">
        <!-- Header -->
	        <header class="app-header">
	            <div class="app-header-inner">
	                <div class="logo" id="logo-home">
	                    <h1>Stonedoku</h1>
	                </div>
	                <nav class="nav-controls">
	                <button id="header-menu-toggle" class="btn btn-icon header-menu-toggle" type="button" aria-label="Open menu" aria-expanded="false" aria-controls="header-menu" title="Menu">
	                    <svg class="ui-icon" aria-hidden="true"><use href="#i-menu"></use></svg>
	                </button>
	                <button id="theme-toggle" class="btn btn-icon" aria-label="Toggle theme" title="Toggle theme">
	                    <span class="icon-stack" aria-hidden="true">
	                        <svg class="ui-icon icon-moon"><use href="#i-moon"></use></svg>
	                        <svg class="ui-icon icon-sun"><use href="#i-sun"></use></svg>
	                    </span>
	                </button>
	                <button id="sound-toggle" class="btn btn-icon" aria-label="Toggle sound" title="Toggle sound">
	                    <span class="icon-stack" aria-hidden="true">
	                        <svg class="ui-icon icon-volume"><use href="#i-volume"></use></svg>
	                        <svg class="ui-icon icon-volume-off"><use href="#i-volume-off"></use></svg>
	                    </span>
	                </button>
		                <div class="header-menu" id="header-menu" aria-label="Header menu">
		                    <div class="user-info" id="user-info" style="display: none;">
		                        <span class="user-status" id="user-status"></span>
		                        <span class="user-name" id="user-name"></span>
		                        <button id="my-profile-btn" class="btn btn-icon" aria-label="My Profile" title="My Profile">
		                            <svg class="ui-icon" aria-hidden="true"><use href="#i-user"></use></svg>
		                        </button>
		                        <button id="logout-btn" class="btn btn-secondary btn-header">Logout</button>
		                    </div>
		                    <button id="updates-nav-btn" class="btn btn-icon" type="button" aria-label="Open updates feed" title="Updates">
		                        <svg class="ui-icon" aria-hidden="true"><use href="#i-book"></use></svg>
		                    </button>
		                    <button id="admin-nav-btn" class="btn btn-icon" type="button" aria-label="Open admin console" title="Admin console" style="display: none;">
		                        <svg class="ui-icon" aria-hidden="true"><use href="#i-gear"></use></svg>
		                    </button>
		                </div>
		            </nav>
		            </div>
		        </header>

	        <!-- Updates Banner -->
	        <section class="updates-banner" id="updates-banner" aria-label="Community updates" style="display: none;">
	            <div class="updates-banner-inner">
	                <div class="updates-banner-mark" aria-hidden="true">
	                    <svg class="ui-icon"><use href="#i-book"></use></svg>
	                </div>
	                <div class="updates-banner-content">
	                    <div class="updates-banner-eyebrow" id="updates-banner-eyebrow">Update</div>
	                    <div class="updates-banner-title" id="updates-banner-title"></div>
	                    <div class="updates-banner-body" id="updates-banner-body"></div>
	                </div>
	                <div class="updates-banner-actions">
	                    <button class="btn btn-outline btn-sm" type="button" id="updates-banner-open">All updates</button>
	                    <button class="btn btn-icon" type="button" id="updates-banner-toggle" aria-label="Expand update" aria-expanded="false" title="Expand">
	                        <svg class="ui-icon" aria-hidden="true"><use href="#i-chevron-down"></use></svg>
	                    </button>
	                    <button class="btn btn-icon" type="button" id="updates-banner-dismiss" aria-label="Dismiss update" title="Dismiss">
	                        <svg class="ui-icon" aria-hidden="true"><use href="#i-x"></use></svg>
	                    </button>
	                </div>
	            </div>
	        </section>

	        <!-- Main Content -->
	        <main class="main-content" id="main-content" role="main">
            <!-- Auth View - Modern Landing -->
            <section id="auth-view" class="view">
                <div class="auth-landing">
                    <!-- Hero Section -->
                    <div class="auth-hero">
                        <div class="hero-content">
                            <div class="hero-badge">
                                <span class="badge-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-bolt"></use></svg></span>
                                <span>Real-time multiplayer</span>
                            </div>
                            <h1 class="hero-title">
                                Master <span class="gradient-text">Sudoku</span><br>
                                Challenge <span class="gradient-text">Friends</span>
                            </h1>
                            <p class="hero-subtitle">
                                The classic puzzle game, reimagined for competitive play. 
                                Race against friends in real-time 1v1 battles.
                            </p>
                            <div class="hero-features">
                                <div class="feature-item">
                                    <span class="feature-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-target"></use></svg></span>
                                    <span>Solo & Versus Modes</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-chart"></use></svg></span>
                                    <span>Track Your Progress</span>
                                </div>
                                <div class="feature-item">
                                    <span class="feature-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-trophy"></use></svg></span>
                                    <span>Earn Achievements</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Decorative Grid -->
                        <div class="hero-visual">
                            <div class="deco-grid">
                                <div class="deco-cell filled">5</div>
                                <div class="deco-cell"></div>
                                <div class="deco-cell accent">3</div>
                                <div class="deco-cell"></div>
                                <div class="deco-cell filled">7</div>
                                <div class="deco-cell"></div>
                                <div class="deco-cell"></div>
                                <div class="deco-cell accent">9</div>
                                <div class="deco-cell filled">1</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Auth Card -->
                    <div class="auth-card">
                        <div class="auth-card-header">
                            <h2>Get Started</h2>
                            <p>Sign in to save progress & play online</p>
                        </div>
                        
                        <!-- Auth Mode Tabs -->
                        <div class="auth-mode-tabs">
                            <button class="auth-tab active" data-mode="signin">Sign In</button>
                            <button class="auth-tab" data-mode="signup">Sign Up</button>
                        </div>
                        
                        <!-- Sign In Panel -->
                        <div class="auth-panel" id="signin-panel">
                            <form id="signin-form" class="auth-form">
                                <div class="form-group">
                                    <label for="signin-email">Email</label>
                                    <input type="email" id="signin-email" placeholder="you@example.com" required>
                                </div>
                                <div class="form-group">
                                    <label for="signin-password">Password</label>
                                    <input type="password" id="signin-password" placeholder="••••••••" required>
                                </div>
                                <div class="form-group">
                                    <button type="button" id="forgot-password" class="link-btn-inline">Forgot password?</button>
                                </div>
                                <button type="submit" class="btn btn-primary btn-lg btn-block">
                                    Sign In
                                </button>
                            </form>
                            
                            <div class="auth-divider">
                                <span>or continue with</span>
                            </div>
                            
                            <button type="button" id="anonymous-login" class="btn btn-guest btn-block">
                                <span class="guest-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-user"></use></svg></span>
                                Play as Guest
                            </button>
                            <p class="guest-note">No account needed • Progress saved locally</p>
                        </div>
                        
                        <!-- Sign Up Panel - Now triggers onboarding -->
                        <div class="auth-panel" id="signup-panel" style="display: none;">
                            <div class="signup-intro">
                                <p class="signup-intro-text">Ready to join the community? Let's get you set up!</p>
                                <button type="button" id="start-onboarding" class="btn btn-primary btn-lg btn-block">
                                    Begin Registration
                                </button>
                            </div>
                            <p class="auth-terms">By signing up, you agree to our <button type="button" class="link-btn-inline" id="auth-terms-link">Terms of Service</button> and <button type="button" class="link-btn-inline" id="auth-privacy-link">Privacy Policy</button></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Onboarding View - Multi-step signup flow -->
            <section id="onboarding-view" class="view" style="display: none;">
                <div class="onboarding-container">
                    <!-- Progress indicator -->
                    <div class="onboarding-progress">
                        <div class="progress-step active" data-step="1">
                            <div class="step-circle"><span class="step-number">1</span></div>
                            <span class="step-label">Name</span>
                        </div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="2">
                            <div class="step-circle"><span class="step-number">2</span></div>
                            <span class="step-label">Account</span>
                        </div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="3">
                            <div class="step-circle"><span class="step-number">3</span></div>
                            <span class="step-label">Profile</span>
                        </div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="4">
                            <div class="step-circle"><span class="step-number">4</span></div>
                            <span class="step-label">Done!</span>
                        </div>
                    </div>

                    <!-- Step 1: Username -->
                    <div class="onboarding-step active" id="onboarding-step-1">
                        <div class="onboarding-card">
                            <div class="onboarding-emoji" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-user"></use></svg></div>
                            <h2 class="onboarding-title">Your name</h2>
                            <p class="onboarding-subtitle">Nice to meet you. What would you like to be called?</p>
                            
                            <div class="onboarding-form">
                                <div class="form-group">
                                    <input type="text" id="onboard-username" class="onboard-input" placeholder="Enter your username" minlength="3" maxlength="20" pattern="^[a-zA-Z0-9_]+$" autofocus>
                                    <span class="form-hint">3-20 characters • Letters, numbers, underscore</span>
                                    <span class="form-error" id="username-error"></span>
                                </div>
                            </div>
                            
                            <div class="onboarding-actions">
                                <button type="button" class="btn btn-secondary" id="onboard-back-1">
                                    ← Back
                                </button>
                                <button type="button" class="btn btn-primary" id="onboard-next-1" disabled>
                                    Continue →
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Email & Password -->
                    <div class="onboarding-step" id="onboarding-step-2">
                        <div class="onboarding-card">
                            <div class="onboarding-emoji" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-mail"></use></svg></div>
                            <h2 class="onboarding-title">Account</h2>
                            <p class="onboarding-subtitle">Secure your access, <span id="onboard-display-name">Player</span>.</p>
                            
                            <div class="onboarding-form">
                                <div class="form-group">
                                    <label for="onboard-email">Email Address</label>
                                    <input type="email" id="onboard-email" class="onboard-input" placeholder="you@example.com">
                                    <span class="form-error" id="email-error"></span>
                                </div>
	                                <div class="form-group">
	                                    <label for="onboard-password">Create Password</label>
	                                    <input type="password" id="onboard-password" class="onboard-input" placeholder="Min 6 chars • Upper/lower • Symbol" minlength="6" maxlength="4096">
	                                    <div class="password-strength" id="password-strength">
	                                        <div class="strength-bar"></div>
	                                        <span class="strength-text"></span>
	                                    </div>
	                                    <span class="form-error" id="password-error"></span>
	                                </div>
                                <div class="form-group">
                                    <label for="onboard-confirm">Confirm Password</label>
                                    <input type="password" id="onboard-confirm" class="onboard-input" placeholder="Type password again" minlength="6">
                                    <span class="form-error" id="confirm-error"></span>
                                </div>
                            </div>
                            
                            <div class="onboarding-actions">
                                <button type="button" class="btn btn-secondary" id="onboard-back-2">
                                    ← Back
                                </button>
                                <button type="button" class="btn btn-primary" id="onboard-next-2" disabled>
                                    Continue →
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Profile Picture (Optional) -->
	                    <div class="onboarding-step" id="onboarding-step-3">
	                        <div class="onboarding-card">
	                            <div class="onboarding-emoji" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-camera"></use></svg></div>
	                            <h2 class="onboarding-title">Looking good!</h2>
	                            <p class="onboarding-subtitle">Add a profile picture so others can recognize you</p>
                            
                            <div class="onboarding-form">
	                                <div class="profile-upload-area" id="profile-upload-area">
	                                    <div class="upload-preview" id="upload-preview">
	                                        <div class="upload-placeholder">
	                                            <span class="upload-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-camera"></use></svg></span>
	                                            <span class="upload-text">Click or drag to upload</span>
	                                        </div>
                                        <img id="preview-image" src="" alt="Preview" style="display: none;">
                                    </div>
                                    <input type="file" id="onboard-avatar" accept="image/*" hidden>
                                </div>
                                <p class="upload-hint">Optional • Max 2MB • JPG, PNG, GIF</p>
                            </div>
                            
                            <div class="onboarding-actions">
                                <button type="button" class="btn btn-secondary" id="onboard-back-3">
                                    ← Back
                                </button>
                                <button type="button" class="btn btn-outline" id="onboard-skip-3">
                                    Skip for now
                                </button>
                                <button type="button" class="btn btn-primary" id="onboard-next-3">
                                    Continue →
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Welcome & Tour Offer -->
                    <div class="onboarding-step" id="onboarding-step-4">
                        <div class="onboarding-card onboarding-final">
                            <div class="onboarding-confetti" id="onboarding-confetti"></div>
                            <div class="onboarding-emoji" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-check"></use></svg></div>
                            <h2 class="onboarding-title">Registration complete</h2>
                            <p class="onboarding-subtitle">Your account is set. Begin orientation?</p>
                            
                            <div class="tour-offer">
                                <div class="tour-card">
                                    <div class="tour-icon" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-globe"></use></svg></div>
                                    <h3>Orientation</h3>
                                    <p>A brief guided walk through the interface</p>
                                    <button type="button" class="btn btn-primary btn-lg" id="start-tour">
                                        Begin
                                    </button>
                                </div>
                                
                                <div class="tour-alt">
                                    <button type="button" class="btn btn-outline" id="skip-tour">
                                        I'll explore on my own
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tour Overlay -->
            <div id="tour-overlay" class="tour-overlay" style="display: none;">
                <div class="tour-spotlight" id="tour-spotlight"></div>
                <div class="tour-tooltip" id="tour-tooltip">
                    <div class="tour-tooltip-content">
                        <h4 id="tour-title">Welcome!</h4>
                        <p id="tour-description">Let's show you around.</p>
                    </div>
                    <div class="tour-tooltip-footer">
                        <div class="tour-progress">
                            <span id="tour-current">1</span> / <span id="tour-total">5</span>
                        </div>
                        <div class="tour-actions">
                            <button type="button" class="btn btn-sm btn-secondary" id="tour-skip">
                                End Tour
                            </button>
                            <button type="button" class="btn btn-sm btn-primary" id="tour-next">
                                Next →
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Password Reset View -->
            <section id="reset-view" class="view" style="display: none;">
                <div class="reset-container">
                        <div class="reset-hero">
                            <div class="hero-badge">
                                <span class="badge-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-lock"></use></svg></span>
                                <span>Account recovery</span>
                            </div>
                        <h2>Reset your password</h2>
                        <p>Enter your email to get a reset link, then set a new password.</p>
                    </div>
                    <div class="auth-card reset-card">
                        <div class="auth-card-header">
                            <h2>Password help</h2>
                            <p>We'll send secure instructions to your inbox.</p>
                        </div>
                        <div id="reset-request-panel" class="reset-panel">
                            <form id="reset-request-form" class="auth-form">
                                <div class="form-group">
                                    <label for="reset-request-email">Email address</label>
                                    <input type="email" id="reset-request-email" placeholder="you@example.com" required>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block">Send reset link</button>
                                <p class="form-hint">We'll send a link that works for 30 minutes.</p>
                                <div class="form-error" id="reset-request-status"></div>
                            </form>
                        </div>
                        <div id="reset-confirm-panel" class="reset-panel" style="display: none;">
                            <div class="reset-summary">
                                <p>Resetting password for</p>
                                <p class="reset-email" id="reset-email-display"></p>
                            </div>
                            <form id="reset-confirm-form" class="auth-form">
	                                <div class="form-group">
	                                    <label for="reset-new-password">New password</label>
	                                    <input type="password" id="reset-new-password" placeholder="Min 6 chars • Upper/lower • Symbol" minlength="6" maxlength="4096" required>
	                                </div>
                                <div class="form-group">
                                    <label for="reset-confirm-password">Confirm password</label>
                                    <input type="password" id="reset-confirm-password" placeholder="Repeat password" minlength="6" required>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block">Update password</button>
                                <div class="form-error" id="reset-confirm-status"></div>
                            </form>
                        </div>
	                        <div id="reset-success-panel" class="reset-panel" style="display: none;">
	                            <div class="reset-success">
	                                <div class="reset-success-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-check"></use></svg></div>
	                                <h3>Password updated</h3>
	                                <p>You can now sign in with your new password.</p>
	                                <button type="button" class="btn btn-primary btn-block" id="reset-return-login">Return to sign in</button>
	                            </div>
	                        </div>
                        <div class="reset-footer">
                            <button type="button" class="link-btn-inline" id="reset-back-to-login">← Back to sign in</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Lobby View -->
            <section id="lobby-view" class="view" style="display: none;">
                <div class="lobby-container">
                    <!-- Welcome Banner -->
                    <div class="lobby-welcome">
                        <div class="welcome-text">
                            <h2>Welcome back, <span class="brand-gradient" id="welcome-name">Player</span></h2>
                            <p>What would you like to play today?</p>
                        </div>
                    </div>

                    <!-- Quick Play Section -->
	                    <div class="lobby-main">
	                        <div class="play-section">
	                            <h3 class="section-title"><svg class="ui-icon" aria-hidden="true"><use href="#i-controller"></use></svg>Choose Your Mode</h3>
	                            <div class="game-mode-grid">
	                                <!-- Single Player Card -->
		                                <div class="game-card single-card">
		                                    <div class="card-badge">Solo</div>
		                                    <div class="card-icon" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-grid"></use></svg></div>
		                                    <div class="card-content">
		                                        <h4>Classic Sudoku</h4>
		                                        <p>Train your skills at your own pace</p>
		                                        <div class="difficulty-buttons">
		                                            <button class="diff-btn easy" data-difficulty="easy">
		                                                <span class="diff-dot diff-dot-easy" aria-hidden="true"></span> Easy
		                                            </button>
		                                            <button class="diff-btn medium" data-difficulty="medium">
		                                                <span class="diff-dot diff-dot-medium" aria-hidden="true"></span> Medium
		                                            </button>
		                                            <button class="diff-btn hard" data-difficulty="hard">
		                                                <span class="diff-dot diff-dot-hard" aria-hidden="true"></span> Hard
		                                            </button>
		                                        </div>
		                                        <button class="btn btn-outline btn-block" type="button" id="open-custom-sudoku">
		                                            <span class="btn-icon-inline" aria-hidden="true"><svg class="ui-icon"><use href="#i-gear"></use></svg></span>
		                                            Custom Sudoku
		                                        </button>
		                                    </div>
		                                </div>

                                <!-- Versus Card -->
	                                <div class="game-card versus-card">
	                                    <div class="card-badge accent">Live</div>
	                                    <div class="card-icon" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-swords"></use></svg></div>
	                                    <div class="card-content">
	                                        <h4>Bust the Board</h4>
	                                        <p>1v1 real-time Sudoku battle</p>
	                                        <div class="versus-actions">
	                                            <button class="btn btn-glow" id="create-room">
	                                                <svg class="ui-icon" aria-hidden="true"><use href="#i-dice"></use></svg>
	                                                Create Game
	                                            </button>
	                                            <div class="join-inline">
	                                                <input type="text" id="room-code-input" placeholder="CODE" maxlength="4">
	                                                <button class="btn btn-outline" id="join-room">Join</button>
	                                            </div>
	                                        </div>
	                                    </div>
	                                </div>
                            </div>
                        </div>

                        <!-- Side Panel -->
	                        <div class="lobby-side">
	                            <!-- Your Stats -->
	                            <div class="stats-card">
	                                <h3 class="section-title"><svg class="ui-icon" aria-hidden="true"><use href="#i-chart"></use></svg>Your Stats</h3>
	                                <div class="stats-row">
	                                    <div class="stat-box">
	                                        <span class="stat-num" id="stat-wins">0</span>
	                                        <span class="stat-lbl">Wins</span>
                                    </div>
                                    <div class="stat-box">
                                        <span class="stat-num" id="stat-losses">0</span>
                                        <span class="stat-lbl">Losses</span>
                                    </div>
                                    <div class="stat-box accent">
                                        <span class="stat-num" id="stat-winrate">0%</span>
                                        <span class="stat-lbl">Win Rate</span>
                                    </div>
                                </div>
                            </div>

	                            <!-- Online Players -->
		                            <div class="players-card">
		                                <h3 class="section-title">
		                                    <svg class="ui-icon" aria-hidden="true"><use href="#i-users"></use></svg>
		                                    Players Online
	                                    <span class="players-count-pill" aria-label="Players online">
	                                        <span class="pulse-dot" aria-hidden="true"></span>
	                                        <span id="online-count">0</span>
	                                    </span>
	                                </h3>
		                                <div class="players-list" id="players-list">
		                                    <div class="empty-players">
		                                        <span class="empty-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-users"></use></svg></span>
		                                        <span>No players online</span>
		                                    </div>
		                                </div>
		                            </div>
		                            <!-- Friends (registered users only) -->
		                            <div class="friends-card" id="friends-card" style="display: none;">
		                                <h3 class="section-title">
		                                    <svg class="ui-icon" aria-hidden="true"><use href="#i-users"></use></svg>
		                                    Friends
		                                </h3>
		                                <div class="friends-section" id="friend-requests-section">
		                                    <div class="friends-section-title">Requests</div>
		                                    <div class="friends-list" id="friend-requests-list"></div>
		                                </div>
		                                <div class="friends-section" id="friends-list-section">
		                                    <div class="friends-section-title">Your friends</div>
		                                    <div class="friends-list" id="friends-list"></div>
		                                </div>
		                            </div>
		                        </div>
	                    </div>
	                </div>
	            </section>

            <!-- Waiting Room View (Waiting for opponent to join) -->
            <section id="waiting-view" class="view" style="display: none;">
	                <div class="waiting-container">
	                    <div class="waiting-card">
	                        <div class="waiting-icon" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-hourglass"></use></svg></div>
	                        <h2>Waiting for Opponent</h2>
	                        <p class="waiting-subtitle">Share this code with a friend to start playing</p>
                        
	                        <div class="room-code-display">
	                            <div class="code-box" id="display-room-code">----</div>
	                            <button class="btn btn-secondary btn-copy" id="copy-code">
	                                <span class="copy-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-copy"></use></svg></span>
	                                Copy Code
	                            </button>
	                        </div>
                        
                        <div class="waiting-animation">
                            <div class="waiting-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <p>Looking for players...</p>
                        </div>
                        
	                        <button class="btn btn-danger btn-cancel" id="cancel-waiting">
	                            <svg class="ui-icon" aria-hidden="true"><use href="#i-x"></use></svg>
	                            Cancel
	                        </button>
	                    </div>
	                </div>
            </section>

            <!-- Pre-Game Lobby (Both players ready up) -->
            <section id="pregame-lobby-view" class="view" style="display: none;">
                <div class="pregame-container">
	                    <div class="pregame-header">
	                        <h2><svg class="ui-icon" aria-hidden="true"><use href="#i-swords"></use></svg>Match Found!</h2>
	                        <p>Get ready for battle</p>
	                    </div>
                    
                    <div class="pregame-players">
                        <!-- Player 1 (Self) -->
	                        <div class="pregame-player self">
	                            <div class="player-avatar" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-user"></use></svg></div>
	                            <div class="player-name" id="pregame-player-name">You</div>
                            <div class="player-ready-status" id="pregame-player-status">
                                <span class="status-text">Not Ready</span>
                            </div>
                        </div>
                        
                        <div class="vs-divider">
                            <span class="vs-text">VS</span>
                            <div class="countdown-display" id="pregame-countdown" style="display: none;">
                                <span class="countdown-number">3</span>
                            </div>
                        </div>
                        
                        <!-- Player 2 (Opponent) -->
	                        <div class="pregame-player opponent">
	                            <div class="player-avatar" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-user"></use></svg></div>
	                            <div class="player-name" id="pregame-opponent-name">Opponent</div>
                            <div class="player-ready-status" id="pregame-opponent-status">
                                <span class="status-text">Not Ready</span>
                            </div>
                        </div>
                    </div>
                    
	                    <div class="pregame-actions">
	                        <button class="btn btn-ready" id="ready-btn">
	                            <span class="ready-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-check"></use></svg></span>
	                            <span class="ready-text">Ready Up!</span>
	                        </button>
                        <button class="btn btn-secondary" id="leave-pregame">
                            Leave Match
                        </button>
                    </div>
                    
	                </div>
	            </section>

            <!-- Game View -->
            <section id="game-view" class="view" style="display: none;">
                <div class="game-container">
                    <!-- Versus Mode Header (hidden in single player) -->
                    <div class="game-header-versus" id="game-header-versus" style="display: none;">
                        <div class="player-info player-self">
                            <span class="player-name" id="game-player-name">You</span>
                            <div class="player-stats-row">
                                <span class="player-score" id="player-score">0</span>
                                <div class="player-lives" id="player-lives">
                                    <span class="life-heart">❤️</span>
                                    <span class="life-heart">❤️</span>
                                    <span class="life-heart">❤️</span>
                                </div>
                            </div>
                        </div>
                        <div class="game-status">
                            <span class="game-timer" id="game-timer-versus">00:00</span>
                            <span class="game-mode-label">Versus Mode</span>
                        </div>
                        <div class="player-info player-opponent">
                            <span class="player-name" id="opponent-name">Opponent</span>
                            <div class="player-stats-row">
                                <span class="player-score" id="opponent-score">0</span>
                                <div class="player-lives" id="opponent-lives">
                                    <span class="life-heart">❤️</span>
                                    <span class="life-heart">❤️</span>
                                    <span class="life-heart">❤️</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Single-player header (timer placement for solo) -->
                    <div class="game-header-single" id="game-header-single" style="display: none;">
                        <div class="game-status">
                            <span class="game-timer" id="game-timer">0:00</span>
                            <span class="game-mode-label">Solo Mode</span>
                        </div>
                    </div>

                    <!-- Left Panel (Single Player Only) -->
                    <div class="game-left-panel" id="game-left-panel">
                        <!-- New Game Card -->
                        <div class="new-game-card">
                            <div class="new-game-header">
                                <h3>New Game</h3>
                                <button class="btn btn-sm btn-secondary" id="restart-btn">
                                    <svg class="ui-icon" aria-hidden="true"><use href="#i-refresh"></use></svg>
                                    Restart
                                </button>
                            </div>
                            <div class="difficulty-grid">
                                <button class="difficulty-btn btn-easy" data-difficulty="easy">Easy</button>
                                <button class="difficulty-btn btn-medium" data-difficulty="medium">Medium</button>
                                <button class="difficulty-btn btn-hard" data-difficulty="hard">Hard</button>
                                <button class="difficulty-btn btn-daily" data-difficulty="daily">Daily</button>
                            </div>
                        </div>

                        <!-- Settings Card -->
                        <div class="settings-card">
                            <h3><svg class="ui-icon" aria-hidden="true"><use href="#i-gear"></use></svg> Settings</h3>
                            <div class="setting-row">
                                <span class="setting-label">Highlight Conflicts</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="highlight-conflicts" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <span class="setting-label">Show Same Numbers</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="highlight-same" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <span class="setting-label">Auto-Check</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="auto-check" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Back to Lobby Button -->
                        <button class="btn btn-secondary" id="quit-game" style="width: 100%;">
                            ← Back to Lobby
                        </button>
                    </div>

                    <!-- Center Panel - Sudoku Grid -->
                    <div class="game-center-panel">
                        <div class="sudoku-wrapper">
                            <div class="sudoku-grid" id="sudoku-grid">
                                <!-- 9x9 grid will be generated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel -->
                    <div class="game-right-panel">
                        <!-- Number Pad -->
                        <div class="number-pad-card">
                            <div class="number-pad" id="number-pad">
                                <button class="num-btn" data-num="1">
                                    <span>1</span>
                                    <span class="remaining" id="remaining-1">9 left</span>
                                </button>
                                <button class="num-btn" data-num="2">
                                    <span>2</span>
                                    <span class="remaining" id="remaining-2">9 left</span>
                                </button>
                                <button class="num-btn" data-num="3">
                                    <span>3</span>
                                    <span class="remaining" id="remaining-3">9 left</span>
                                </button>
                                <button class="num-btn" data-num="4">
                                    <span>4</span>
                                    <span class="remaining" id="remaining-4">9 left</span>
                                </button>
                                <button class="num-btn" data-num="5">
                                    <span>5</span>
                                    <span class="remaining" id="remaining-5">9 left</span>
                                </button>
                                <button class="num-btn" data-num="6">
                                    <span>6</span>
                                    <span class="remaining" id="remaining-6">9 left</span>
                                </button>
                                <button class="num-btn" data-num="7">
                                    <span>7</span>
                                    <span class="remaining" id="remaining-7">9 left</span>
                                </button>
                                <button class="num-btn" data-num="8">
                                    <span>8</span>
                                    <span class="remaining" id="remaining-8">9 left</span>
                                </button>
                                <button class="num-btn" data-num="9">
                                    <span>9</span>
                                    <span class="remaining" id="remaining-9">9 left</span>
                                </button>
                            </div>
                        </div>

                        <!-- Progress Card -->
                        <div class="progress-card">
                            <div class="game-info-grid">
                                <div class="game-info-item">
                                    <span class="game-info-label">Difficulty</span>
                                    <span class="game-info-value" id="current-difficulty">Medium</span>
                                </div>
                                <div class="game-info-item">
                                    <span class="game-info-label">Mistakes</span>
                                    <div class="mistakes-display" id="mistakes-display">
                                        <span class="mistake-dot empty"></span>
                                        <span class="mistake-dot empty"></span>
                                        <span class="mistake-dot empty"></span>
                                    </div>
                                </div>
	                                <div class="game-info-item">
	                                    <span class="game-info-label">Time</span>
	                                    <span class="game-info-value" id="time-limit-value">—</span>
	                                </div>
	                            </div>
	                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons-card">
                            <div class="action-buttons">
                                <button class="action-btn" id="undo-btn">
                                    <span class="icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-undo"></use></svg></span>
                                    <span>Undo</span>
                                </button>
                                <button class="action-btn" id="hint-btn">
                                    <span class="icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-bulb"></use></svg></span>
                                    <span>Hint</span>
                                </button>
                                <button class="action-btn" id="erase-btn">
                                    <span class="icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-backspace"></use></svg></span>
                                    <span>Erase</span>
                                </button>
                                <button class="action-btn" id="notes-btn">
                                    <span class="icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-pencil"></use></svg></span>
                                    <span>Notes</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Game Over Modal (Single Player) -->
            <div id="game-over-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="game-over-title">Game Over!</h2>
                    </div>
	                    <div class="modal-body">
	                        <div class="result-display" id="result-display">
	                            <div class="result-icon" id="result-icon" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-trophy"></use></svg></div>
	                            <p id="result-message">You won!</p>
	                        </div>
                        <div class="game-stats">
                            <div class="stat-row">
                                <span>Your Score:</span>
                                <span id="final-score">0</span>
                            </div>
                            <div class="stat-row">
                                <span>Time:</span>
                                <span id="final-time">00:00</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" id="play-again">Play Again</button>
                        <button class="btn btn-secondary" id="back-to-lobby">Back to Lobby</button>
                    </div>
                </div>
            </div>

            <!-- Post-Match Screen (Versus Mode) -->
            <section id="postmatch-view" class="view" style="display: none;">
                <div class="postmatch-container">
                    <div class="postmatch-header">
                        <h1 id="postmatch-title">Match Complete!</h1>
                    </div>
                    
	                    <div class="postmatch-result">
	                        <div class="postmatch-player winner" id="postmatch-winner">
	                            <div class="trophy-icon" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-trophy"></use></svg></div>
	                            <div class="result-label">WINNER</div>
	                            <div class="player-avatar" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-user"></use></svg></div>
	                            <div class="player-name" id="postmatch-winner-name">Player</div>
	                            <div class="player-score" id="postmatch-winner-score">0 points</div>
	                        </div>
                        
                        <div class="postmatch-vs">
                            <div class="vs-badge">VS</div>
                        </div>
                        
	                        <div class="postmatch-player loser" id="postmatch-loser">
	                            <div class="result-label">DEFEATED</div>
	                            <div class="player-avatar" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-user"></use></svg></div>
	                            <div class="player-name" id="postmatch-loser-name">Opponent</div>
	                            <div class="player-score" id="postmatch-loser-score">0 points</div>
	                        </div>
	                    </div>
                    
	                    <div class="postmatch-stats">
	                        <div class="stat-card">
	                            <span class="stat-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-hourglass"></use></svg></span>
	                            <span class="stat-value" id="postmatch-time">00:00</span>
	                            <span class="stat-label">Time</span>
	                        </div>
	                        <div class="stat-card">
	                            <span class="stat-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-chart"></use></svg></span>
	                            <span class="stat-value" id="postmatch-reason">Completed</span>
	                            <span class="stat-label">Result</span>
	                        </div>
	                    </div>
                    
                    <div class="postmatch-rematch">
                        <div class="rematch-status" id="rematch-status">
                            <span class="rematch-text">Want a rematch?</span>
                        </div>
                        
	                        <div class="rematch-votes">
	                            <div class="vote-indicator self" id="rematch-vote-self">
	                                <span class="vote-icon" aria-hidden="true">?</span>
	                                <span class="vote-label">You</span>
	                            </div>
	                            <div class="vote-indicator opponent" id="rematch-vote-opponent">
	                                <span class="vote-icon" aria-hidden="true">?</span>
	                                <span class="vote-label">Opponent</span>
	                            </div>
	                        </div>
                        
	                        <div class="rematch-actions" id="rematch-actions">
	                            <button class="btn btn-success btn-rematch" id="rematch-yes">
	                                <svg class="ui-icon" aria-hidden="true"><use href="#i-check"></use></svg>
	                                Rematch!
	                            </button>
	                            <button class="btn btn-danger btn-no-rematch" id="rematch-no">
	                                <svg class="ui-icon" aria-hidden="true"><use href="#i-x"></use></svg>
	                                No Thanks
	                            </button>
	                        </div>
                        
                        <div class="rematch-waiting" id="rematch-waiting" style="display: none;">
                            <div class="waiting-dots">
                                <span></span><span></span><span></span>
                            </div>
                            <p>Waiting for opponent's decision...</p>
                        </div>
                        
                        <button class="btn btn-secondary btn-back-lobby" id="postmatch-back-lobby">
                            Back to Lobby
                        </button>
                    </div>
                </div>
            </section>

            <!-- Profile Page View -->
            <section id="profile-view" class="view" style="display: none;">
                <div class="profile-page-container">
                    <div class="profile-page-header">
                        <button class="btn btn-secondary btn-back" id="profile-back-btn">← Back</button>
                        <h1 id="profile-page-title">Player Profile</h1>
                    </div>
                    
                    <div class="profile-page-content">
                        <!-- Profile Card -->
	                        <div class="profile-card-main">
	                            <div class="profile-picture-wrapper">
	                                <img src="" alt="Profile Picture" id="profile-page-picture" class="profile-picture">
	                                <div class="profile-picture-placeholder" id="profile-picture-placeholder" aria-hidden="true"><svg class="ui-icon ui-icon-xl"><use href="#i-user"></use></svg></div>
	                                <label class="profile-picture-edit" id="profile-picture-edit" style="display: none;">
	                                    <input type="file" accept="image/*" id="profile-picture-input">
	                                    <span class="edit-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-camera"></use></svg></span>
	                                </label>
	                            </div>
                            
                            <div class="profile-details">
                                <h2 id="profile-page-username">Username</h2>
                                <p class="profile-bio" id="profile-page-bio">No bio yet...</p>
                                <textarea class="profile-bio-edit" id="profile-bio-input" placeholder="Write something about yourself..." maxlength="200" style="display: none;"></textarea>
                                <div class="profile-edit-fields" id="profile-edit-fields" style="display: none;">
                                    <div class="form-group">
                                        <label for="profile-twitter">Twitter</label>
                                        <input type="url" id="profile-twitter" placeholder="https://twitter.com/yourhandle">
                                    </div>
                                    <div class="form-group">
                                        <label for="profile-discord">Discord</label>
                                        <input type="text" id="profile-discord" placeholder="username#1234">
                                    </div>
                                </div>
                                <p class="profile-member-date">Member since <span id="profile-page-member-since">---</span></p>
	                                <div class="profile-vanity-url" id="profile-vanity-url">
                                    <span class="vanity-label">Profile URL:</span>
                                    <a href="#" id="profile-vanity-link">stone-doku.web.app/u/username</a>
	                                    <button class="btn btn-icon btn-copy-url" id="copy-profile-url" title="Copy URL" aria-label="Copy profile URL"><svg class="ui-icon" aria-hidden="true"><use href="#i-copy"></use></svg></button>
	                                </div>
	                            </div>
	                        </div>
                        
	                        <!-- Stats Section -->
	                        <div class="profile-stats-section">
	                            <h3><svg class="ui-icon" aria-hidden="true"><use href="#i-chart"></use></svg>Statistics</h3>
	                            <div class="profile-stats-grid">
	                                <div class="profile-stat-card">
	                                    <span class="stat-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-trophy"></use></svg></span>
	                                    <span class="stat-value" id="profile-page-wins">0</span>
	                                    <span class="stat-label">Wins</span>
	                                </div>
	                                <div class="profile-stat-card">
	                                    <span class="stat-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-x"></use></svg></span>
	                                    <span class="stat-value" id="profile-page-losses">0</span>
	                                    <span class="stat-label">Losses</span>
	                                </div>
	                                <div class="profile-stat-card accent">
	                                    <span class="stat-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-chart"></use></svg></span>
	                                    <span class="stat-value" id="profile-page-winrate">0%</span>
	                                    <span class="stat-label">Win Rate</span>
	                                </div>
	                                <div class="profile-stat-card">
	                                    <span class="stat-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-controller"></use></svg></span>
	                                    <span class="stat-value" id="profile-page-games">0</span>
	                                    <span class="stat-label">Games Played</span>
	                                </div>
	                            </div>
	                        </div>
                        
	                        <!-- Badges Section -->
	                        <div class="profile-badges-section">
	                            <h3><svg class="ui-icon" aria-hidden="true"><use href="#i-trophy"></use></svg>Badges</h3>
	                            <div class="profile-badges-grid" id="profile-page-badges">
	                                <div class="badge-empty">No badges yet. Keep playing to earn badges!</div>
	                            </div>
	                        </div>
                        
	                        <!-- Social Sharing -->
	                        <div class="profile-social-section">
	                            <h3><svg class="ui-icon" aria-hidden="true"><use href="#i-send"></use></svg>Share Your Stats</h3>
	                            <div class="social-share-buttons">
                                <button class="btn btn-social btn-twitter" id="share-twitter">
                                    <span class="social-icon">𝕏</span> Share on X
                                </button>
                                <button class="btn btn-social btn-facebook" id="share-facebook">
                                    <span class="social-icon">f</span> Share on Facebook
                                </button>
	                                <button class="btn btn-social btn-copy" id="share-copy">
	                                    <span class="social-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-copy"></use></svg></span>
	                                    Copy Stats
	                                </button>
	                            </div>
	                        </div>
                        
	                        <!-- Actions for own profile -->
	                        <div class="profile-actions" id="profile-own-actions" style="display: none;">
	                            <button class="btn btn-primary" id="edit-profile-btn"><svg class="ui-icon" aria-hidden="true"><use href="#i-pencil"></use></svg>Edit Profile</button>
	                            <button class="btn btn-success" id="save-profile-btn" style="display: none;"><svg class="ui-icon" aria-hidden="true"><use href="#i-check"></use></svg>Save Changes</button>
	                            <button class="btn btn-secondary" id="cancel-edit-btn" style="display: none;">Cancel</button>
	                        </div>
                        
                        <!-- Actions for other profiles -->
	                        <div class="profile-actions" id="profile-other-actions" style="display: none;">
	                            <button class="btn btn-primary" id="profile-challenge-btn"><svg class="ui-icon" aria-hidden="true"><use href="#i-swords"></use></svg><span class="btn-label">Challenge</span></button>
	                            <button class="btn btn-secondary" id="profile-friend-btn"><svg class="ui-icon" aria-hidden="true"><use href="#i-users"></use></svg><span class="btn-label">Add Friend</span></button>
	                            <button class="btn btn-accent" id="profile-dm-btn"><svg class="ui-icon" aria-hidden="true"><use href="#i-chat"></use></svg><span class="btn-label">Message</span></button>
	                        </div>
	                    </div>
	                </div>
	            </section>

	            <!-- Updates / Community Feed -->
		            <section id="updates-view" class="view" style="display: none;">
		                <div class="updates-page">
	                    <div class="updates-page-header">
	                        <h2 class="section-title"><svg class="ui-icon" aria-hidden="true"><use href="#i-book"></use></svg>Updates</h2>
	                        <div class="updates-page-actions">
	                            <button type="button" class="btn btn-secondary btn-sm" id="updates-back-btn">← Back</button>
	                        </div>
	                    </div>
	                    <div class="updates-page-subtitle">News, planned works, and status changes.</div>
		                    <div class="updates-feed" id="updates-feed" aria-live="polite">
		                        <!-- Update items rendered by app.js -->
		                    </div>
		                </div>
		            </section>

		            <!-- Admin Console -->
		            <section id="admin-view" class="view" style="display: none;">
		                <div class="admin-page">
		                    <div class="admin-page-header">
		                        <h2 class="section-title"><svg class="ui-icon" aria-hidden="true"><use href="#i-gear"></use></svg>Admin Console</h2>
		                        <div class="admin-page-actions">
		                            <button type="button" class="btn btn-secondary btn-sm" id="admin-back-btn">← Back</button>
		                        </div>
		                    </div>
		                    <div class="admin-grid">
		                        <div class="admin-card">
		                            <h3 class="admin-card-title">Post update</h3>
		                            <form id="admin-update-form" class="auth-form">
		                                <div class="form-group">
		                                    <label for="admin-update-title">Title</label>
		                                    <input type="text" id="admin-update-title" required maxlength="120" autocomplete="off">
		                                </div>
		                                <div class="form-group">
		                                    <label for="admin-update-body">Body</label>
		                                    <textarea id="admin-update-body" rows="5" required maxlength="1200"></textarea>
		                                </div>
		                                <div class="form-group">
		                                    <label for="admin-update-kind">Kind</label>
		                                    <select id="admin-update-kind">
		                                        <option value="update" selected>Update</option>
		                                        <option value="status">Status</option>
		                                        <option value="maintenance">Maintenance</option>
		                                    </select>
		                                </div>
		                                <div class="form-group">
		                                    <label for="admin-update-severity">Severity</label>
		                                    <select id="admin-update-severity">
		                                        <option value="info" selected>Info</option>
		                                        <option value="warn">Warn</option>
		                                        <option value="critical">Critical</option>
		                                    </select>
		                                </div>
		                                <div class="form-group admin-flags">
		                                    <label class="setting-row">
		                                        <span class="setting-label">Show in banner</span>
		                                        <span class="toggle-switch">
		                                            <input type="checkbox" id="admin-update-banner" checked>
		                                            <span class="toggle-slider"></span>
		                                        </span>
		                                    </label>
		                                    <label class="setting-row">
		                                        <span class="setting-label">Pinned</span>
		                                        <span class="toggle-switch">
		                                            <input type="checkbox" id="admin-update-pinned">
		                                            <span class="toggle-slider"></span>
		                                        </span>
		                                    </label>
		                                </div>
		                                <div class="admin-form-actions">
		                                    <button class="btn btn-primary" type="submit">Publish</button>
		                                </div>
		                            </form>
		                            <div class="form-error" id="admin-update-status"></div>
		                        </div>
		                        <div class="admin-card">
		                            <h3 class="admin-card-title">Manage updates</h3>
		                            <div class="admin-updates-list" id="admin-updates-list" aria-live="polite"></div>
		                        </div>
		                    </div>
		                </div>
		            </section>

	            <!-- Challenge Modal -->
		            <div id="challenge-modal" class="modal" style="display: none;">
	                <div class="modal-content">
	                    <div class="modal-header">
	                        <h2>Challenge Received!</h2>
	                    </div>
	                    <div class="modal-body">
	                        <p><strong id="challenger-name">Player</strong> has challenged you to a match!</p>
	                    </div>
	                    <div class="modal-footer">
	                        <button class="btn btn-primary" id="accept-challenge">Accept</button>
	                        <button class="btn btn-secondary" id="decline-challenge">Decline</button>
	                    </div>
	                </div>
	            </div>

	            <!-- Custom Sudoku Modal -->
		            <div id="custom-sudoku-modal" class="modal" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="custom-sudoku-title">
		                <div class="modal-content">
	                    <div class="modal-header">
	                        <h2 id="custom-sudoku-title">Custom Sudoku</h2>
	                    </div>
	                    <div class="modal-body">
	                        <form id="custom-sudoku-form" class="auth-form">
	                            <div class="form-group">
	                                <label for="custom-difficulty">Difficulty</label>
	                                <select id="custom-difficulty">
	                                    <option value="easy">Easy</option>
	                                    <option value="medium" selected>Medium</option>
	                                    <option value="hard">Hard</option>
	                                </select>
	                            </div>
	                            <div class="form-group">
	                                <label for="custom-time-limit">Time limit</label>
	                                <select id="custom-time-limit">
	                                    <option value="0" selected>None</option>
	                                    <option value="300">5 minutes</option>
	                                    <option value="600">10 minutes</option>
	                                    <option value="900">15 minutes</option>
	                                </select>
	                                <p class="form-hint">Sets a deadline; the header timer still shows elapsed time.</p>
	                            </div>
	                            <div class="form-group">
	                                <label for="custom-mistakes">Mistake limit</label>
	                                <select id="custom-mistakes">
	                                    <option value="3" selected>3 mistakes</option>
	                                    <option value="5">5 mistakes</option>
	                                </select>
	                            </div>
	                            <div class="form-group">
	                                <label class="setting-row" style="justify-content: space-between;">
	                                    <span class="setting-label">Auto-check</span>
	                                    <span class="toggle-switch">
	                                        <input type="checkbox" id="custom-auto-check" checked>
	                                        <span class="toggle-slider"></span>
	                                    </span>
	                                </label>
	                                <p class="form-hint">If off, entries aren’t revealed immediately, but mistakes still count.</p>
	                            </div>
	                        </form>
	                    </div>
	                    <div class="modal-footer">
	                        <button class="btn btn-primary" type="submit" form="custom-sudoku-form" id="custom-sudoku-start">Start</button>
	                        <button class="btn btn-secondary" type="button" id="custom-sudoku-cancel">Cancel</button>
	                    </div>
		                </div>
		            </div>

		            <!-- Start DM Modal -->
		            <div id="dm-start-modal" class="modal" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="dm-start-title">
		                <div class="modal-content">
		                    <div class="modal-header">
		                        <h2 id="dm-start-title">Start a direct message</h2>
		                    </div>
		                    <div class="modal-body">
		                        <form id="dm-start-form" class="auth-form">
		                            <div class="form-group">
		                                <label for="dm-start-username">Username</label>
		                                <input type="text" id="dm-start-username" placeholder="Search username…" autocomplete="off">
		                                <span class="form-hint">DMs are available to registered users.</span>
		                            </div>
		                        </form>
		                        <div class="dm-start-results" id="dm-start-results" aria-live="polite"></div>
		                    </div>
		                    <div class="modal-footer">
		                        <button class="btn btn-primary" type="submit" form="dm-start-form" id="dm-start-open">Open</button>
		                        <button class="btn btn-secondary" type="button" id="dm-start-cancel">Cancel</button>
		                    </div>
		                </div>
		            </div>

		            <!-- Hover Profile Tooltip -->
		            <div id="hover-profile" class="hover-profile" style="display: none;">
	                <div class="hover-profile-header">
                    <span class="hover-profile-status"></span>
                    <span class="hover-profile-name">Player</span>
                </div>
                <div class="hover-profile-stats">
                    <div class="hover-stat">
                        <span class="hover-stat-value" id="hover-wins">0</span>
                        <span class="hover-stat-label">W</span>
                    </div>
                    <div class="hover-stat">
                        <span class="hover-stat-value" id="hover-losses">0</span>
                        <span class="hover-stat-label">L</span>
                    </div>
                    <div class="hover-stat accent">
                        <span class="hover-stat-value" id="hover-winrate">0%</span>
                        <span class="hover-stat-label">Rate</span>
                    </div>
                </div>
                <div class="hover-profile-activity" id="hover-activity">Playing</div>
            </div>

            <!-- Profile Modal -->
            <div id="profile-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Player Profile</h2>
                        <button class="modal-close" id="close-profile">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="profile-info">
                            <h3 id="profile-name">Player Name</h3>
                            <p id="profile-member-since">Member since: ---</p>
                        </div>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <span class="stat-value" id="profile-wins">0</span>
                                <span class="stat-label">Wins</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="profile-losses">0</span>
                                <span class="stat-label">Losses</span>
                            </div>
                        </div>
                        <div class="profile-badges" id="profile-badges">
                            <!-- Badges will be displayed here -->
                        </div>
                        <button class="btn btn-primary" id="challenge-player">Challenge to Match</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Floating Chat Widget -->
	        <div id="chat-widget" class="chat-widget minimized">
	            <div class="chat-widget-header" id="chat-widget-header">
	                <div class="chat-widget-tabs" id="chat-widget-tabs">
	                    <button class="widget-tab active" data-chat="global"><svg class="ui-icon" aria-hidden="true"><use href="#i-globe"></use></svg>Global</button>
	                    <button class="widget-tab" data-chat="game" id="widget-game-tab" style="display: none;"><svg class="ui-icon" aria-hidden="true"><use href="#i-users"></use></svg>Game</button>
	                    <button class="widget-tab" data-chat="dms" id="widget-dms-tab"><svg class="ui-icon" aria-hidden="true"><use href="#i-chat"></use></svg>DMs</button>
	                </div>
	                <div class="chat-widget-controls">
	                    <span class="unread-badge" id="unread-badge" style="display: none;">0</span>
	                    <button class="widget-btn" id="chat-minimize" title="Minimize" aria-label="Minimize chat"><svg class="ui-icon" aria-hidden="true"><use href="#i-minus"></use></svg></button>
	                    <button class="widget-btn" id="chat-maximize" title="Maximize" aria-label="Maximize chat"><svg class="ui-icon" aria-hidden="true"><use href="#i-maximize"></use></svg></button>
	                </div>
	            </div>
            <div class="chat-widget-body">
                <!-- DM List (shown when DMs tab active) -->
		                <div class="dm-list" id="dm-list" style="display: none;">
		                    <div class="dm-list-header">
		                        <span>Direct Messages</span>
		                        <button class="widget-btn" type="button" id="new-dm-btn" title="Start new conversation" aria-label="Start new conversation"><svg class="ui-icon" aria-hidden="true"><use href="#i-plus"></use></svg></button>
		                    </div>
	                    <div class="dm-conversations" id="dm-conversations">
	                        <div class="dm-empty">No conversations yet. Start one from a profile or the + button.</div>
	                    </div>
	                </div>
                <div class="chat-widget-messages" id="chat-widget-messages"></div>
                <div class="emoji-picker-widget" id="emoji-picker-widget" style="display: none;">
                    <div class="emoji-grid">
                        <button type="button" class="emoji-btn">😀</button>
                        <button type="button" class="emoji-btn">😊</button>
                        <button type="button" class="emoji-btn">😎</button>
                        <button type="button" class="emoji-btn">🤔</button>
                        <button type="button" class="emoji-btn">😅</button>
                        <button type="button" class="emoji-btn">🎉</button>
                        <button type="button" class="emoji-btn">👍</button>
                        <button type="button" class="emoji-btn">👏</button>
                        <button type="button" class="emoji-btn">🔥</button>
                        <button type="button" class="emoji-btn">💪</button>
                        <button type="button" class="emoji-btn">😤</button>
                        <button type="button" class="emoji-btn">🤯</button>
                        <button type="button" class="emoji-btn">👀</button>
                        <button type="button" class="emoji-btn">💡</button>
                        <button type="button" class="emoji-btn">⚡</button>
                        <button type="button" class="emoji-btn">✨</button>
                        <button type="button" class="emoji-btn">🏆</button>
                        <button type="button" class="emoji-btn">🎯</button>
                        <button type="button" class="emoji-btn">🧩</button>
                        <button type="button" class="emoji-btn">💀</button>
                        <button type="button" class="emoji-btn">❤️</button>
                        <button type="button" class="emoji-btn">😂</button>
                        <button type="button" class="emoji-btn">🙌</button>
                        <button type="button" class="emoji-btn">🤝</button>
                    </div>
	                </div>
		                <div class="chat-hint" id="chat-hint">
		                    <svg class="ui-icon" aria-hidden="true"><use href="#i-bulb"></use></svg>
		                    <span id="chat-hint-text">Tip: Use @whisper username message to send private messages</span>
	                </div>
                <form class="chat-widget-form" id="chat-widget-form">
                    <button type="button" class="emoji-toggle-btn" id="widget-emoji-toggle" aria-label="Emoji picker"><svg class="ui-icon" aria-hidden="true"><use href="#i-smile"></use></svg></button>
                    <input type="text" id="chat-widget-input" placeholder="Type a message..." maxlength="200" autocomplete="off">
                    <button type="submit" class="send-btn" aria-label="Send message"><svg class="ui-icon" aria-hidden="true"><use href="#i-send"></use></svg></button>
                </form>
	            </div>
	        </div>

        <!-- Chat Toggle Button (when minimized) -->
        <button id="chat-fab" class="chat-fab">
            <span class="fab-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-chat"></use></svg></span>
            <span class="fab-unread" id="fab-unread" style="display: none;">0</span>
        </button>

        <!-- Footer -->
        <footer class="app-footer" role="contentinfo">
            <div class="footer-content">
                <p>&copy; 2024 Stonedoku. Real-time competitive Sudoku.</p>
                <nav class="footer-links" aria-label="Legal links">
                    <button type="button" class="link-btn" id="privacy-link">Privacy Policy</button>
                    <span class="footer-separator">•</span>
                    <button type="button" class="link-btn" id="terms-link">Terms of Service</button>
                    <span class="footer-separator">•</span>
                    <button type="button" class="link-btn" id="cookies-link">Cookie Policy</button>
                    <span class="footer-separator">•</span>
                    <button type="button" class="link-btn" id="accessibility-link">Accessibility</button>
                </nav>
                <p class="footer-legal">Made in the UK 🇬🇧</p>
            </div>
        </footer>
    </div>

    <!-- Cookie Consent Banner (UK PECR Compliant) -->
	    <div id="cookie-consent" class="cookie-banner" role="dialog" aria-labelledby="cookie-title" aria-describedby="cookie-desc" style="display: none;">
	        <div class="cookie-content">
	            <div class="cookie-header">
	                <span class="cookie-icon" aria-hidden="true"><svg class="ui-icon"><use href="#i-cookie"></use></svg></span>
	                <h2 id="cookie-title">Cookie Preferences</h2>
	            </div>
            <p id="cookie-desc">We use cookies to enhance your experience. Under UK law (PECR), we need your consent for non-essential cookies.</p>
            <div class="cookie-options">
                <label class="cookie-option">
                    <input type="checkbox" id="cookie-essential" checked disabled>
                    <span class="option-content">
                        <strong>Essential</strong>
                        <small>Required for the app to function</small>
                    </span>
                </label>
                <label class="cookie-option">
                    <input type="checkbox" id="cookie-analytics">
                    <span class="option-content">
                        <strong>Analytics</strong>
                        <small>Help us improve by tracking usage</small>
                    </span>
                </label>
                <label class="cookie-option">
                    <input type="checkbox" id="cookie-preferences">
                    <span class="option-content">
                        <strong>Preferences</strong>
                        <small>Remember your settings</small>
                    </span>
                </label>
            </div>
            <div class="cookie-actions">
                <button type="button" id="cookie-accept-all" class="btn btn-primary">Accept All</button>
                <button type="button" id="cookie-accept-selected" class="btn btn-secondary">Accept Selected</button>
                <button type="button" id="cookie-reject" class="btn btn-ghost">Essential Only</button>
            </div>
            <p class="cookie-more">
                <button type="button" class="link-btn" id="cookie-learn-more">Learn more about our cookies</button>
            </p>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacy-modal" class="legal-modal" role="dialog" aria-labelledby="privacy-title" aria-modal="true" style="display: none;">
        <div class="legal-modal-content">
            <div class="legal-modal-header">
                <h1 id="privacy-title">Privacy Policy</h1>
                <button type="button" class="modal-close" aria-label="Close privacy policy">&times;</button>
            </div>
            <div class="legal-modal-body">
                <p class="legal-updated">Last updated: 20 December 2024</p>
                
                <section>
                    <h2>1. Introduction</h2>
                    <p>Stonedoku ("we", "our", "us") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, and safeguard your personal data in compliance with the UK General Data Protection Regulation (UK GDPR) and the Data Protection Act 2018.</p>
                    <p><strong>Data Controller:</strong> Stonedoku<br>
                    <strong>Contact:</strong> privacy@stonedoku.com</p>
                </section>

                <section>
                    <h2>2. Data We Collect</h2>
                    <h3>2.1 Information You Provide</h3>
                    <ul>
                        <li><strong>Account Information:</strong> Email address and password when you create an account</li>
                        <li><strong>Profile Data:</strong> Display name you choose</li>
                        <li><strong>Communications:</strong> Chat messages sent during gameplay</li>
                    </ul>
                    
                    <h3>2.2 Automatically Collected Data</h3>
                    <ul>
                        <li><strong>Usage Data:</strong> Game statistics (wins, losses, scores)</li>
                        <li><strong>Technical Data:</strong> Browser type, device information, IP address</li>
                        <li><strong>Online Status:</strong> Presence information for multiplayer features</li>
                    </ul>
                </section>

                <section>
                    <h2>3. How We Use Your Data</h2>
                    <p>We process your data under the following legal bases:</p>
                    <ul>
                        <li><strong>Contract Performance:</strong> To provide the gaming service you've requested</li>
                        <li><strong>Legitimate Interests:</strong> To improve our service and prevent abuse</li>
                        <li><strong>Consent:</strong> For optional analytics and marketing (where applicable)</li>
                    </ul>
                </section>

                <section>
                    <h2>4. Data Sharing</h2>
                    <p>We use Firebase (Google) for authentication and data storage. Data may be processed in:</p>
                    <ul>
                        <li>European Economic Area (EEA)</li>
                        <li>United States (under Standard Contractual Clauses)</li>
                    </ul>
                    <p>We do not sell your personal data to third parties.</p>
                </section>

                <section>
                    <h2>5. Your Rights (UK GDPR)</h2>
                    <p>You have the right to:</p>
                    <ul>
                        <li><strong>Access:</strong> Request a copy of your personal data</li>
                        <li><strong>Rectification:</strong> Correct inaccurate data</li>
                        <li><strong>Erasure:</strong> Request deletion of your data ("right to be forgotten")</li>
                        <li><strong>Portability:</strong> Receive your data in a portable format</li>
                        <li><strong>Object:</strong> Object to processing based on legitimate interests</li>
                        <li><strong>Withdraw Consent:</strong> Where processing is based on consent</li>
                    </ul>
                    <p>To exercise these rights, contact us at privacy@stonedoku.com</p>
                </section>

                <section>
                    <h2>6. Data Retention</h2>
                    <ul>
                        <li>Account data: Retained until you delete your account</li>
                        <li>Chat messages: 30 days</li>
                        <li>Game statistics: Retained until account deletion</li>
                        <li>Anonymous analytics: 26 months</li>
                    </ul>
                </section>

                <section>
                    <h2>7. Security</h2>
                    <p>We implement appropriate security measures including:</p>
                    <ul>
                        <li>Encryption in transit (HTTPS/TLS)</li>
                        <li>Secure authentication via Firebase</li>
                        <li>Database access controls</li>
                        <li>Regular security reviews</li>
                    </ul>
                </section>

                <section>
                    <h2>8. Children's Privacy</h2>
                    <p>Our service is not directed at children under 13. We do not knowingly collect data from children under 13. If you believe we have collected such data, please contact us immediately.</p>
                </section>

                <section>
                    <h2>9. Changes to This Policy</h2>
                    <p>We may update this policy periodically. Significant changes will be notified via the app or email.</p>
                </section>

                <section>
                    <h2>10. Contact & Complaints</h2>
                    <p>For privacy enquiries: privacy@stonedoku.com</p>
                    <p>You have the right to lodge a complaint with the Information Commissioner's Office (ICO):<br>
                    Website: <a href="https://ico.org.uk" target="_blank" rel="noopener">ico.org.uk</a><br>
                    Helpline: 0303 123 1113</p>
                </section>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div id="terms-modal" class="legal-modal" role="dialog" aria-labelledby="terms-title" aria-modal="true" style="display: none;">
        <div class="legal-modal-content">
            <div class="legal-modal-header">
                <h1 id="terms-title">Terms of Service</h1>
                <button type="button" class="modal-close" aria-label="Close terms of service">&times;</button>
            </div>
            <div class="legal-modal-body">
                <p class="legal-updated">Last updated: 20 December 2024</p>
                
                <section>
                    <h2>1. Agreement to Terms</h2>
                    <p>By accessing or using Stonedoku, you agree to be bound by these Terms of Service. If you disagree with any part, you may not access the service.</p>
                </section>

                <section>
                    <h2>2. Description of Service</h2>
                    <p>Stonedoku provides an online Sudoku game with single-player and multiplayer functionality. The service is provided "as is" and may be modified at any time.</p>
                </section>

                <section>
                    <h2>3. User Accounts</h2>
                    <ul>
                        <li>You must provide accurate information when creating an account</li>
                        <li>You are responsible for maintaining account security</li>
                        <li>You must not share your account credentials</li>
                        <li>You must be at least 13 years old to use the service</li>
                    </ul>
                </section>

                <section>
                    <h2>4. Acceptable Use</h2>
                    <p>You agree NOT to:</p>
                    <ul>
                        <li>Use the service for any unlawful purpose</li>
                        <li>Harass, abuse, or harm other users</li>
                        <li>Use cheats, exploits, or automation tools</li>
                        <li>Impersonate others or provide false information</li>
                        <li>Attempt to gain unauthorized access to systems</li>
                        <li>Post offensive, hateful, or inappropriate content in chat</li>
                        <li>Spam or send unsolicited messages</li>
                    </ul>
                </section>

                <section>
                    <h2>5. Intellectual Property</h2>
                    <p>The Stonedoku name, logo, and all content are owned by us or our licensors. The Sudoku puzzles are generated algorithmically. You may not:</p>
                    <ul>
                        <li>Copy, modify, or distribute our content</li>
                        <li>Use our trademarks without permission</li>
                        <li>Reverse engineer the application</li>
                    </ul>
                </section>

                <section>
                    <h2>6. User Content</h2>
                    <p>You retain rights to content you submit (e.g., chat messages). By posting, you grant us a license to display this content. We may remove content that violates these terms.</p>
                </section>

                <section>
                    <h2>7. Termination</h2>
                    <p>We may terminate or suspend your account at any time for violations of these terms, without prior notice. You may delete your account at any time.</p>
                </section>

                <section>
                    <h2>8. Disclaimers</h2>
                    <p>THE SERVICE IS PROVIDED "AS IS" WITHOUT WARRANTIES OF ANY KIND. We do not guarantee:</p>
                    <ul>
                        <li>Continuous, uninterrupted service</li>
                        <li>Error-free operation</li>
                        <li>Availability in all regions</li>
                    </ul>
                </section>

                <section>
                    <h2>9. Limitation of Liability</h2>
                    <p>To the fullest extent permitted by UK law, we shall not be liable for any indirect, incidental, special, or consequential damages arising from your use of the service.</p>
                </section>

                <section>
                    <h2>10. Governing Law</h2>
                    <p>These terms are governed by the laws of England and Wales. Any disputes shall be subject to the exclusive jurisdiction of the courts of England and Wales.</p>
                </section>

                <section>
                    <h2>11. Changes to Terms</h2>
                    <p>We may modify these terms at any time. Continued use after changes constitutes acceptance of the new terms.</p>
                </section>

                <section>
                    <h2>12. Contact</h2>
                    <p>For questions about these terms: legal@stonedoku.com</p>
                </section>
            </div>
        </div>
    </div>

    <!-- Cookie Policy Modal -->
    <div id="cookies-modal" class="legal-modal" role="dialog" aria-labelledby="cookies-title" aria-modal="true" style="display: none;">
        <div class="legal-modal-content">
            <div class="legal-modal-header">
                <h1 id="cookies-title">Cookie Policy</h1>
                <button type="button" class="modal-close" aria-label="Close cookie policy">&times;</button>
            </div>
            <div class="legal-modal-body">
                <p class="legal-updated">Last updated: 20 December 2024</p>
                
                <section>
                    <h2>1. What Are Cookies?</h2>
                    <p>Cookies are small text files stored on your device when you visit a website. They help websites remember your preferences and improve your experience.</p>
                </section>

                <section>
                    <h2>2. UK Law (PECR)</h2>
                    <p>Under the Privacy and Electronic Communications Regulations (PECR), we must obtain your consent before placing non-essential cookies on your device.</p>
                </section>

                <section>
                    <h2>3. Cookies We Use</h2>
                    
                    <h3>3.1 Essential Cookies (Required)</h3>
                    <table class="cookie-table">
                        <thead>
                            <tr><th>Name</th><th>Purpose</th><th>Duration</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>firebase-auth</td><td>Authentication state</td><td>Session</td></tr>
                            <tr><td>cookie-consent</td><td>Your cookie preferences</td><td>1 year</td></tr>
                        </tbody>
                    </table>

                    <h3>3.2 Preference Cookies (Optional)</h3>
                    <table class="cookie-table">
                        <thead>
                            <tr><th>Name</th><th>Purpose</th><th>Duration</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>theme</td><td>Light/dark mode preference</td><td>1 year</td></tr>
                            <tr><td>sound-enabled</td><td>Sound settings</td><td>1 year</td></tr>
                            <tr><td>game-settings</td><td>Game preferences</td><td>1 year</td></tr>
                        </tbody>
                    </table>

                    <h3>3.3 Analytics Cookies (Optional)</h3>
                    <p>We may use analytics cookies to understand how visitors use our site. Currently, we use Firebase Analytics which may set cookies to track:</p>
                    <ul>
                        <li>Pages visited</li>
                        <li>Time spent on site</li>
                        <li>Actions taken</li>
                    </ul>
                </section>

                <section>
                    <h2>4. Local Storage</h2>
                    <p>We also use browser local storage for:</p>
                    <ul>
                        <li>Guest account game progress</li>
                        <li>UI preferences</li>
                        <li>Offline functionality</li>
                    </ul>
                </section>

                <section>
                    <h2>5. Managing Cookies</h2>
                    <p>You can manage cookies through:</p>
                    <ul>
                        <li>Our cookie preference banner (appears on first visit)</li>
                        <li>Your browser settings</li>
                        <li>The footer link to update preferences</li>
                    </ul>
                    <p>Note: Disabling essential cookies may affect functionality.</p>
                </section>

                <section>
                    <h2>6. Third-Party Cookies</h2>
                    <p>Our service uses Firebase (Google). Google may set their own cookies. See <a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Google's Privacy Policy</a> for details.</p>
                </section>

                <section>
                    <h2>7. Updates</h2>
                    <p>We may update this policy. Check this page for the latest version.</p>
                </section>

                <section>
                    <h2>8. Contact</h2>
                    <p>Questions about cookies: privacy@stonedoku.com</p>
                </section>
            </div>
        </div>
    </div>

    <!-- Accessibility Statement Modal -->
    <div id="accessibility-modal" class="legal-modal" role="dialog" aria-labelledby="accessibility-title" aria-modal="true" style="display: none;">
        <div class="legal-modal-content">
            <div class="legal-modal-header">
                <h1 id="accessibility-title">Accessibility Statement</h1>
                <button type="button" class="modal-close" aria-label="Close accessibility statement">&times;</button>
            </div>
            <div class="legal-modal-body">
                <p class="legal-updated">Last updated: 20 December 2024</p>
                
                <section>
                    <h2>1. Our Commitment</h2>
                    <p>Stonedoku is committed to ensuring digital accessibility for people with disabilities. We continually improve the user experience for everyone and apply relevant accessibility standards.</p>
                </section>

                <section>
                    <h2>2. Standards</h2>
                    <p>We aim to conform to the Web Content Accessibility Guidelines (WCAG) 2.1 Level AA. These guidelines explain how to make web content more accessible to people with disabilities.</p>
                </section>

                <section>
                    <h2>3. Accessibility Features</h2>
                    <ul>
                        <li><strong>Keyboard Navigation:</strong> All interactive elements are keyboard accessible</li>
                        <li><strong>Screen Reader Support:</strong> ARIA labels and landmarks for assistive technology</li>
                        <li><strong>Focus Indicators:</strong> Visible focus states for keyboard users</li>
                        <li><strong>Color Contrast:</strong> Text meets WCAG AA contrast requirements</li>
                        <li><strong>Reduced Motion:</strong> Respects system preferences for reduced animation</li>
                        <li><strong>Scalable Text:</strong> Content remains usable when text is enlarged</li>
                        <li><strong>Skip Links:</strong> Quickly navigate to main content</li>
                        <li><strong>Alt Text:</strong> Descriptive text for visual elements</li>
                    </ul>
                </section>

                <section>
                    <h2>4. Known Limitations</h2>
                    <p>While we strive for full accessibility, some features may have limitations:</p>
                    <ul>
                        <li>Real-time multiplayer may be challenging for screen reader users due to rapid updates</li>
                        <li>Some game animations may be distracting for users with cognitive disabilities</li>
                    </ul>
                    <p>We are actively working to improve these areas.</p>
                </section>

                <section>
                    <h2>5. Assistive Technology</h2>
                    <p>This website has been tested with:</p>
                    <ul>
                        <li>VoiceOver (macOS/iOS)</li>
                        <li>NVDA (Windows)</li>
                        <li>Keyboard-only navigation</li>
                    </ul>
                </section>

                <section>
                    <h2>6. Feedback</h2>
                    <p>We welcome your feedback on accessibility. If you encounter barriers or have suggestions:</p>
                    <p><strong>Email:</strong> accessibility@stonedoku.com</p>
                    <p>We aim to respond within 5 business days.</p>
                </section>

                <section>
                    <h2>7. Enforcement</h2>
                    <p>If you're not satisfied with our response, you can contact the Equality Advisory Support Service (EASS):</p>
                    <p>Website: <a href="https://www.equalityadvisoryservice.com" target="_blank" rel="noopener">equalityadvisoryservice.com</a></p>
                </section>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="/app.js?v=20251221D"></script>
    <script src="/effects.js"></script>
        </div>
    </div>
</body>
</html>
